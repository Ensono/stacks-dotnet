variables:
# Versioning
- name: Version.Major
  value: 1
- name: Version.Minor
  value: 0
- name: Version.MajorMinor
  value: $(Version.Major).$(Version.Minor)
- name: Version.Revision
  value: $[counter(variables['Version.MajorMinor'], 0)]
- name: Package.Path
  value: 'src/services/api/xxAMIDOxx.xxSTACKSxx.Models/'

name: $(build.SourceBranchName)-init

resources:
- repo: self

trigger:
  paths:
    include:
    - src/services/api/xxAMIDOxx.xxSTACKSxx.Models/*


pool:
  vmImage: 'ubuntu-latest'

steps:

- script: echo '##vso[build.updatebuildnumber]$(Version.MajorMinor).$(Version.Revision)'
  displayName: Update Build Number

- task: NuGetCommand@2
  inputs:
    command: pack
    versioningScheme: byPrereleaseNumber
    majorVersion: '$(Version.Major)'
    minorVersion: '$(Version.Minor)'
    patchVersion: '$(Version.Revision)'
    packagesToPack: '$(Package.Path)/*.csproj'

- task: NuGetCommand@2
  displayName: 'NuGet push'
  inputs:
    command: push
    publishVstsFeed: 'Temp'
    allowPackageConflicts: true